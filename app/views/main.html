<div layout-xs="column" layout-gt-xs="row" layout-fill class="layout-fill-height-fix">
    <!-- My wallet widget -->
    <md-card class="widget-card" flex-gt-xs="50" flex-xs="100" ng-controller="MyWalletWidgetCtrl as ctrl">
        <md-progress-linear ng-show="ctrl.loading" md-mode="indeterminate"></md-progress-linear>
        <md-card-header ng-class="ctrl.loading ? 'loading' : ''">
            <md-card-avatar>
                <md-icon class="md-avatar-icon">account_balance_wallet</md-icon>
            </md-card-avatar>
            <md-card-header-text>
                <span class="md-title">Your wallet</span>
                <span class="md-subhead">Updated <span am-time-ago="ctrl.lastUpdate"></span></span>
            </md-card-header-text>
            <md-button class="md-icon-button" ng-click="ctrl.update(true);">
                <md-icon>refresh</md-icon>
                <md-tooltip md-delay="600" md-direction="top">
                    Refresh the balance and generate a new address
                </md-tooltip>
            </md-button>
        </md-card-header>

        <md-card-content class="widget-content">
            <div layout="row" layout-align="center center">
                <span flex="15">Address:</span>
                <span flex="85" class="code">{{ctrl.address}}</span>
            </div>

            <div layout="row" class="widget-line" layout-align="center center" style="margin-top: 12px;">
                <span flex="35">Confirmed balance:</span>
                <span flex="65" style="text-align: right;">{{ctrl.confirmedBalance}} XBT</span>
            </div>
            <div layout="row" class="widget-line" layout-align="center center">
                <span flex="35">Unconfirmed balance:</span>
                <span flex="65" style="text-align: right;">{{ctrl.unconfirmedBalance}} XBT</span>
            </div>
        </md-card-content>
    </md-card>

    <!-- Send pay widget -->
    <md-card class="widget-card" flex-gt-xs="50" flex-xs="100" ng-controller="SendPayWidgetCtrl as ctrl">
        <md-progress-linear ng-show="ctrl.loading" md-mode="indeterminate"></md-progress-linear>
        <md-card-header ng-class="ctrl.loading ? 'loading' : ''">
            <md-card-avatar>
                <md-icon class="md-avatar-icon">send</md-icon>
            </md-card-avatar>
            <md-card-header-text>
                <span class="md-title">Pay an invoice</span>
                <span class="md-subhead">Send a payment to a Lightning node</span>
            </md-card-header-text>
        </md-card-header>

        <md-card-content class="widget-content">
            <form name="sendPayForm">

                <md-input-container class="md-block">
                    <label>RHash</label>
                    <input required name="rhash" ng-model="ctrl.payment.rhash">
                    <div ng-messages="sendPayForm.rhash.$error">
                        <div ng-message="required">This is required.</div>

                        <!-- TODO: validate rhash -->
                    </div>
                </md-input-container>

                <div layout="row" layout-align="space-between center">
                    <md-input-container flex="80">
                        <label>Route</label>
                        <input ng-required="!ctrl.payment.autoRoute" ng-disabled="ctrl.payment.autoRoute" name="route"
                               ng-model="ctrl.payment.route">
                        <div ng-messages="sendPayForm.route.$error">
                            <div ng-message="required">This is required.</div>

                            <!-- TODO: validate the route -->
                        </div>
                    </md-input-container>

                    <md-input-container flex="20">
                        <md-checkbox class="md-primary" ng-model="ctrl.payment.autoRoute">
                            Auto
                        </md-checkbox>
                    </md-input-container>
                </div>

                <div ng-show="ctrl.payment.autoRoute">
                    <md-input-container class="md-block">
                        <label>Node</label>
                        <input ng-required="ctrl.payment.autoRoute" name="node" ng-model="ctrl.payment.nodeid">
                        <div ng-messages="sendPayForm.node.$error">
                            <div ng-message="required">This is required.</div>

                            <!-- TODO: validate nodeid -->
                        </div>
                    </md-input-container>

                    <div layout="row" layout-align="space-between center">
                        <md-input-container class="md-block" flex="50">
                            <label>Amount</label>
                            <input type="number" ng-required="ctrl.payment.autoRoute" name="amount"
                                   ng-model="ctrl.payment.amount">
                            <div ng-messages="sendPayForm.amount.$error">
                                <div ng-message="required">This is required.</div>

                                <!-- TODO: check > 0 -->
                            </div>
                        </md-input-container>


                        <md-input-container class="md-block" flex="50">
                            <label>Risk Factor</label>
                            <input type="number" ng-required="ctrl.payment.autoRoute" name="riskFactor"
                                   ng-model="ctrl.payment.riskFactor">
                            <div ng-messages="sendPayForm.riskFactor.$error">
                                <div ng-message="required">This is required.</div>

                                <!-- TODO: check >= 0 -->
                            </div>
                        </md-input-container>
                    </div>
                </div>

                <div layout="row" layout-align="left center">
                    <md-button style="margin: 0;" class="md-raised md-primary" ng-disabled="sendPayForm.$invalid"
                               flex="1" ng-click="ctrl.submit()">Send payment
                    </md-button>
                    <md-progress-circular ng-if="ctrl.calculatingRoute" flex="98" class="half-size"
                                          style="margin-left: 15px;"></md-progress-circular>
                    <span ng-if="ctrl.calculatingRoute" flex="1">Calculating the route...</span>
                </div>
            </form>
        </md-card-content>
    </md-card>
</div>
